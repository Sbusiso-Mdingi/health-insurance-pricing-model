output$risk_badge <- renderUI({
# Simulated portfolio benchmark
ages <- 18:85
benchmark <- data.frame(
Age = ages,
Sex = "male",
BMI = 25,
Smoker = "no",
Region = "southeast",
Childeren = 0
)
portfolio_premiums <- expected_premium(benchmark)
q40 <- quantile(portfolio_premiums, 0.40)
q75 <- quantile(portfolio_premiums, 0.75)
risk_class <- if (premium_val() < q40) {
list("Low Risk", "success")
} else if (premium_val() < q75) {
list("Medium Risk", "warning")
} else {
list("High Risk", "danger")
}
tags$div(
class = paste0("badge bg-", risk_class[[2]], " fs-6 mt-2"),
risk_class[[1]]
)
})
# -------- Breakdown --------
output$breakdown <- renderTable({
freq <- predict(freq_pois, user_data(), type = "response")
sev  <- predict_expected_severity(sev_lm, user_data(), sigma_hat)
pure <- freq * sev
data.frame(
Metric = c(
"Expected Claim Frequency",
"Expected Claim Severity",
"Pure Premium",
"Final Premium"
),
Value = c(
round(freq, 4),
round(sev, 2),
round(pure, 2),
round(premium_val(), 2)
)
)
})
# -------- Age Curve --------
output$age_curve <- renderPlot({
age_df <- data.frame(
Age = 18:85,
Sex = input$sex,
BMI = input$bmi,
Smoker = input$smoker,
Region = input$region,
Childeren = input$children
)
age_df$Premium <- expected_premium(age_df, input$loading)
ggplot(age_df, aes(Age, Premium)) +
geom_line(color = "#1abc9c", linewidth = 1.2) +
geom_vline(xintercept = input$age, linetype = "dashed", alpha = 0.6) +
theme_minimal(base_size = 12) +
theme(
plot.background = element_rect(fill = "transparent", color = NA),
panel.background = element_rect(fill = "transparent", color = NA),
text = element_text(color = "white"),
axis.text = element_text(color = "white")
) +
labs(
x = "Age",
y = "Annual Premium"
)
})
}
shinyApp(ui, server)
library(shiny)
library(dplyr)
library(splines)
library(MASS)
library(broom)
library(bslib)
library(ggplot2)
# --------------------------------------------------
# LOAD TRAINED MODELS
# --------------------------------------------------
freq_pois  <- readRDS("../models/freq_model.rds")
sev_lm     <- readRDS("../models/sev_model.rds")
sigma_hat  <- readRDS("../models/sigma_hat.rds")
# --------------------------------------------------
# HELPER FUNCTIONS
# --------------------------------------------------
predict_expected_severity <- function(model, newdata, sigma) {
mu_log <- predict(model, newdata = newdata)
exp(mu_log + 0.5 * sigma^2)
}
expected_premium <- function(df, loading = 0) {
freq <- predict(freq_pois, newdata = df, type = "response")
sev  <- predict_expected_severity(sev_lm, df, sigma_hat)
freq * sev * (1 + loading)
}
# --------------------------------------------------
# THEME
# --------------------------------------------------
theme <- bs_theme(
version = 5,
bootswatch = "darkly",
bg = "#0b0b0b",
fg = "#f2f2f2",
primary = "#1abc9c",
base_font = font_google("Inter")
)
# --------------------------------------------------
# UI
# --------------------------------------------------
ui <- fluidPage(
theme = theme,
fluidRow(
column(
12,
h1("Health Insurance Pricing Dashboard",
class = "text-center mt-4 mb-1"),
p(
"Frequency–Severity Pricing Model",
class = "text-center text-muted mb-4"
)
)
),
fluidRow(
# -------- Inputs --------
column(
4,
card(
card_header("Policyholder Characteristics"),
sliderInput("age", "Age", min = 18, max = 100, value = 30),
sliderInput("bmi", "BMI", min = 18, max = 45, value = 25, step = 0.1),
sliderInput("children", "Number of Children", min = 0, max = 5, value = 0),
selectInput("sex", "Sex", choices = c("male", "female")),
selectInput("smoker", "Smoking Status", choices = c("no", "yes")),
selectInput(
"region",
"Region",
choices = c("southeast", "southwest", "northeast", "northwest")
)
),
card(
card_header("Pricing Assumptions"),
sliderInput(
"loading",
"Total Loading (Expenses + Profit)",
min = 0,
max = 1,
value = 0.30,
step = 0.01
)
)
),
# -------- Outputs --------
column(
8,
card(
card_header("Indicative Annual Premium"),
h2(
textOutput("premium"),
class = "text-center fw-bold text-success"
),
uiOutput("risk_badge"),
p(
"Expected annual premium per policyholder, including loadings.",
class = "text-center text-muted"
)
),
card(
card_header("Pricing Breakdown"),
tableOutput("breakdown")
),
card(
card_header("Age–Premium Curve (Other Factors Held Constant)"),
plotOutput("age_curve", height = "250px")
)
)
),
fluidRow(
column(
12,
hr(),
p(
"Synthetic data. Demonstration use only.",
class = "text-center text-muted"
)
)
)
)
# --------------------------------------------------
# SERVER
# --------------------------------------------------
server <- function(input, output) {
user_data <- reactive({
data.frame(
Age = input$age,
Sex = factor(input$sex, levels = c("male", "female")),
BMI = input$bmi,
Smoker = factor(input$smoker, levels = c("no", "yes")),
Region = factor(
input$region,
levels = c("southeast", "southwest", "northeast", "northwest")
),
Children = input$children
)
})
premium_val <- reactive({
expected_premium(user_data(), input$loading)
})
# -------- Premium Text --------
output$premium <- renderText({
paste0(
"R ",
format(round(premium_val(), 2), big.mark = ",")
)
})
# -------- Risk Badge --------
output$risk_badge <- renderUI({
# Simulated portfolio benchmark
ages <- 18:85
benchmark <- data.frame(
Age = ages,
Sex = "male",
BMI = 25,
Smoker = "no",
Region = "southeast",
Children = 0
)
portfolio_premiums <- expected_premium(benchmark)
q40 <- quantile(portfolio_premiums, 0.40)
q75 <- quantile(portfolio_premiums, 0.75)
risk_class <- if (premium_val() < q40) {
list("Low Risk", "success")
} else if (premium_val() < q75) {
list("Medium Risk", "warning")
} else {
list("High Risk", "danger")
}
tags$div(
class = paste0("badge bg-", risk_class[[2]], " fs-6 mt-2"),
risk_class[[1]]
)
})
# -------- Breakdown --------
output$breakdown <- renderTable({
freq <- predict(freq_pois, user_data(), type = "response")
sev  <- predict_expected_severity(sev_lm, user_data(), sigma_hat)
pure <- freq * sev
data.frame(
Metric = c(
"Expected Claim Frequency",
"Expected Claim Severity",
"Pure Premium",
"Final Premium"
),
Value = c(
round(freq, 4),
round(sev, 2),
round(pure, 2),
round(premium_val(), 2)
)
)
})
# -------- Age Curve --------
output$age_curve <- renderPlot({
age_df <- data.frame(
Age = 18:85,
Sex = input$sex,
BMI = input$bmi,
Smoker = input$smoker,
Region = input$region,
Children = input$children
)
age_df$Premium <- expected_premium(age_df, input$loading)
ggplot(age_df, aes(Age, Premium)) +
geom_line(color = "#1abc9c", linewidth = 1.2) +
geom_vline(xintercept = input$age, linetype = "dashed", alpha = 0.6) +
theme_minimal(base_size = 12) +
theme(
plot.background = element_rect(fill = "transparent", color = NA),
panel.background = element_rect(fill = "transparent", color = NA),
text = element_text(color = "white"),
axis.text = element_text(color = "white")
) +
labs(
x = "Age",
y = "Annual Premium"
)
})
}
shinyApp(ui, server)
library(shiny)
library(dplyr)
library(splines)
library(MASS)
library(broom)
library(bslib)
library(ggplot2)
# --------------------------------------------------
# LOAD TRAINED MODELS
# --------------------------------------------------
freq_pois  <- readRDS("../models/freq_model.rds")
sev_lm     <- readRDS("../models/sev_model.rds")
sigma_hat  <- readRDS("../models/sigma_hat.rds")
# --------------------------------------------------
# HELPER FUNCTIONS
# --------------------------------------------------
predict_expected_severity <- function(model, newdata, sigma) {
mu_log <- predict(model, newdata = newdata)
exp(mu_log + 0.5 * sigma^2)
}
expected_premium <- function(df, loading = 0) {
freq <- predict(freq_pois, newdata = df, type = "response")
sev  <- predict_expected_severity(sev_lm, df, sigma_hat)
freq * sev * (1 + loading)
}
# --------------------------------------------------
# THEME
# --------------------------------------------------
theme <- bs_theme(
version = 5,
bootswatch = "darkly",
bg = "#0b0b0b",
fg = "#f2f2f2",
primary = "#1abc9c",
base_font = font_google("Inter")
)
# --------------------------------------------------
# UI
# --------------------------------------------------
ui <- fluidPage(
theme = theme,
fluidRow(
column(
12,
h1("Health Insurance Pricing Dashboard",
class = "text-center mt-4 mb-1"),
p(
"Frequency–Severity Pricing Model",
class = "text-center text-muted mb-4"
)
)
),
fluidRow(
# -------- Inputs --------
column(
4,
card(
card_header("Policyholder Characteristics"),
sliderInput("age", "Age", min = 18, max = 100, value = 30),
sliderInput("bmi", "BMI", min = 18, max = 45, value = 25, step = 0.1),
sliderInput("children", "Number of Children", min = 0, max = 5, value = 0),
selectInput("sex", "Sex", choices = c("male", "female")),
selectInput("smoker", "Smoking Status", choices = c("no", "yes")),
selectInput(
"region",
"Region",
choices = c("southeast", "southwest", "northeast", "northwest")
)
),
card(
card_header("Pricing Assumptions"),
sliderInput(
"loading",
"Total Loading (Expenses + Profit)",
min = 0,
max = 1,
value = 0.30,
step = 0.01
)
)
),
# -------- Outputs --------
column(
8,
card(
card_header("Indicative Annual Premium"),
h2(
textOutput("premium"),
class = "text-center fw-bold text-success"
),
uiOutput("risk_badge"),
p(
"Expected annual premium per policyholder, including loadings.",
class = "text-center text-muted"
)
),
card(
card_header("Pricing Breakdown"),
tableOutput("breakdown")
),
card(
card_header("Age–Premium Curve (Other Factors Held Constant)"),
plotOutput("age_curve", height = "250px")
)
)
),
fluidRow(
column(
12,
hr(),
p(
"Synthetic data. Demonstration use only.",
class = "text-center text-muted"
)
)
)
)
# --------------------------------------------------
# SERVER
# --------------------------------------------------
server <- function(input, output) {
user_data <- reactive({
data.frame(
Age = input$age,
Sex = factor(input$sex, levels = c("male", "female")),
BMI = input$bmi,
Smoker = factor(input$smoker, levels = c("no", "yes")),
Region = factor(
input$region,
levels = c("southeast", "southwest", "northeast", "northwest")
),
Children = input$children
)
})
premium_val <- reactive({
expected_premium(user_data(), input$loading)
})
# -------- Premium Text --------
output$premium <- renderText({
paste0(
"R ",
format(round(premium_val(), 2), big.mark = ",")
)
})
# -------- Risk Badge --------
output$risk_badge <- renderUI({
# Simulated portfolio benchmark
ages <- 18:85
benchmark <- data.frame(
Age = ages,
Sex = "male",
BMI = 25,
Smoker = "no",
Region = "southeast",
Children = 0
)
portfolio_premiums <- expected_premium(benchmark)
q40 <- quantile(portfolio_premiums, 0.40)
q75 <- quantile(portfolio_premiums, 0.75)
risk_class <- if (premium_val() < q40) {
list("Low Risk", "success")
} else if (premium_val() < q75) {
list("Medium Risk", "warning")
} else {
list("High Risk", "danger")
}
tags$div(
class = paste0("badge bg-", risk_class[[2]], " fs-6 mt-2"),
risk_class[[1]]
)
})
# -------- Breakdown --------
output$breakdown <- renderTable({
freq <- predict(freq_pois, user_data(), type = "response")
sev  <- predict_expected_severity(sev_lm, user_data(), sigma_hat)
pure <- freq * sev
data.frame(
Metric = c(
"Expected Claim Frequency",
"Expected Claim Severity",
"Pure Premium",
"Final Premium"
),
Value = c(
round(freq, 4),
round(sev, 2),
round(pure, 2),
round(premium_val(), 2)
)
)
})
# -------- Age Curve --------
output$age_curve <- renderPlot({
age_df <- data.frame(
Age = 18:85,
Sex = input$sex,
BMI = input$bmi,
Smoker = input$smoker,
Region = input$region,
Children = input$children
)
age_df$Premium <- expected_premium(age_df, input$loading)
ggplot(age_df, aes(Age, Premium)) +
geom_line(color = "#1abc9c", linewidth = 1.2) +
geom_vline(xintercept = input$age, linetype = "dashed", alpha = 0.6) +
theme_minimal(base_size = 12) +
theme(
plot.background = element_rect(fill = "transparent", color = NA),
panel.background = element_rect(fill = "transparent", color = NA),
text = element_text(color = "black"),
axis.text = element_text(color = "black")
) +
labs(
x = "Age",
y = "Annual Premium"
)
})
}
shinyApp(ui, server)
